import React, { useEffect, useState } from 'react';
import { useParams } from 'react-router-dom';
import { db } from '../db/Firebase.js'; 
import { doc, getDoc } from 'firebase/firestore';

function ItemDetail() {
  const { prodId } = useParams();
  const [product, setProduct] = useState(null);
  const [isLoading, setIsLoading] = useState(true);
  const [isMounted, setIsMounted] = useState(true); // Agrega esta variable de estado

  useEffect(() => {
    setIsMounted(true); // Componente montado

    return () => {
      setIsMounted(false); // Componente desmontado
    };
  }, []);

  useEffect(() => {
    const getProductFromFirebase = async () => {
      try {
        const productDocRef = doc(db, 'productos', prodId);
        console.log('Buscando producto con prodId:', prodId);
        const productDoc = await getDoc(productDocRef);

        if (isMounted && productDoc.exists()) { // Verifica si el componente está montado
          const productData = productDoc.data();
          setProduct(productData);
          setIsLoading(false);
        } else if (isMounted) { // Verifica si el componente está montado
          setIsLoading(false);
          console.error('No se encontró el producto con el ID proporcionado.');
        }
      } catch (error) {
        if (isMounted) { // Verifica si el componente está montado
          setIsLoading(false);
          console.error('Error al obtener los detalles del producto:', error);
        }
      }
    };

    getProductFromFirebase();
  }, [prodId, isMounted]); // Añade isMounted como dependencia

  return (
    <div className="container mx-auto">
      {isLoading ? (
        <div className="flex items-center justify-center h-screen text-lg">
          Cargando...
        </div>
      ) : product ? (
        <div className="flex flex-col items-center mt-8">
          <h2 className="text-2xl font-semibold mb-4">{product.title}</h2>
          <p className="text-lg mt-4">Descripción: {product.description}</p> 
        </div>
      ) : (
        <p>No se encontró el producto.</p>
      )}
    </div>
  );
}

export default ItemDetail;
